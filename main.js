(()=>{"use strict";function e(e,t,n,o,r,a){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button");c.querySelector(".card__title").textContent=e.name;var s=c.querySelector(".card__image");s.setAttribute("src",e.link),s.setAttribute("alt",e.name),s.setAttribute("data-card-db-id",e._id);var l=c.querySelector(".card__like-count"),p=e.likes.length;return l.textContent=p>0?p:"0",e.likes.forEach((function(e){e._id===o&&u.classList.add("card__like-button_is-active")})),n==o&&i.classList.remove("card__delete-button_non_active"),i.addEventListener("click",(function(){t.del(r,a).then((function(){c.remove()}))})),u.addEventListener("click",(function(){t.like(u,r,l,a,t)})),s.addEventListener("click",t.popupwork),c}var t=function(e){if(e.target.classList.contains("popup")){var t=e.target;o(t)}},n=function(e){if(e.target.classList.contains("popup__close")){var t=e.target.closest(".popup");o(t)}},o=function(e){e.classList.remove("popup_is-opened")};function r(e){!function(e){e.classList.add("popup_is-opened")}(e)}var a={baseURL:"https://nomoreparties.co/v1/wff-cohort-27/",headers:{authorization:"ddd596ee-85bf-4265-8de1-cba520c31b24","Content-Type":"application/json"}};function c(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var i=["users/me","cards"].map((function(e){return fetch("".concat(a.baseURL).concat(e),{headers:a.headers}).then(c)}));function u(e){var t=e.modal.querySelector(e.popupBtn);e.isLoading?t.textContent="Сохранение...":e.createBtn?t.textContent="Создать":t.textContent="Сохранить"}var s=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function l(e,t,n){t.errorMsgClear&&Array.from(e.querySelectorAll(n.inputSelector)).forEach((function(t){s(e,t,n)}));var o=e.querySelector(".popup__button");t.enableBtn?(o.disabled=!1,o.classList.remove(n.inactiveButtonClass)):(o.disabled=!0,o.classList.add(n.inactiveButtonClass))}var p=document.querySelector(".places").querySelector(".places__list"),d=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),m=f.querySelector(".popup__image"),v=f.querySelector(".popup__caption"),y=document.querySelector(".popup_type_avatar"),h=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__image"),L=document.querySelector(".profile__info"),q=L.querySelector(".profile__title"),g=L.querySelector(".profile__description"),C=document.querySelector("form[name=edit-profile]"),k=C.querySelector(".popup__input_type_name"),E=C.querySelector(".popup__input_type_description"),B=document.querySelector("form[name=new-place]"),A=document.querySelector("form[name=new-avatar]"),x=document.querySelector(".profile__image"),w=document.querySelectorAll(".popup"),P={formSelector:".popup__form",inputSelector:".popup__input",inputSelectorURL:"popup__input_type_url",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button__submit_inactive",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"};document.addEventListener("keydown",(function(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&o(t)})),w.forEach((function(e){e.addEventListener("mousedown",t),e.addEventListener("click",n)}));var U,R={del:function(e,t){return fetch("".concat(t.baseURL,"cards/").concat(e),{method:"DELETE",headers:t.headers}).then(c)},like:function(e,t,n,o,r){e.classList.contains("card__like-button_is-active")?(e.classList.remove("card__like-button_is-active"),r.delAPI(t,o).then((function(e){var t=e.likes.length;n.textContent=t}))):(e.classList.add("card__like-button_is-active"),r.likeAPI(t,o).then((function(e){var t=e.likes.length;n.textContent=t})))},popupwork:function(e){r(f),m.setAttribute("src",e.target.src),m.setAttribute("alt",e.target.alt),v.textContent=e.target.alt},delAPI:function(e,t){return fetch("".concat(t.baseURL,"cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then(c)},likeAPI:function(e,t){return fetch("".concat(t.baseURL,"cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(c)}};Promise.all(i).then((function(t){q.textContent=t[0].name,g.textContent=t[0].about,x.setAttribute("style","background-image: url(".concat(t[0].avatar,")"));var n=t[0]._id;t[1].forEach((function(t){var o=e(t,R,t.owner._id,n,t._id,a);p.append(o)}))})).catch((function(e){console.log(e)})),S.addEventListener("click",(function(){r(y),l(y,{errorMsgClear:!1,enableBtn:!1},P)})),y.addEventListener("submit",(function(e){e.preventDefault(),u({modal:y,popupBtn:".popup__button",isLoading:!0,createBtn:!1}),function(e,t){return fetch("".concat(t.baseURL,"users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then(c)}(y.querySelector(".popup__input").value,a).then((function(e){x.setAttribute("style","background-image: url(".concat(e.avatar))})).then((function(){u({modal:y,popupBtn:".popup__button",isLoading:!1,createBtn:!1}),o(y),A.reset()})).catch((function(e){console.log(e)}))})),h.addEventListener("click",(function(){r(d),k.value=q.textContent,E.value=g.textContent,l(d,{errorMsgClear:!0,enableBtn:!0},P)})),C.addEventListener("submit",(function(e){e.preventDefault(),u({modal:d,popupBtn:".popup__button",isLoading:!0,createBtn:!1}),function(e,t,n){return fetch("".concat(n.baseURL,"users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:e.value,about:t.value})}).then(c)}(k,E,a).then((function(){q.textContent=k.value,g.textContent=E.value})).then((function(){u({modal:d,popupBtn:".popup__button",isLoading:!1,createBtn:!1}),o(d)})).catch((function(e){console.log(e)}))})),b.addEventListener("click",(function(){r(_),l(_,{errorMsgClear:!1,enableBtn:!1},P)})),B.addEventListener("submit",(function(t){t.preventDefault();var n={name:B.querySelector(".popup__input_type_card-name").value,link:B.querySelector(".popup__input_type_url").value};u({modal:_,popupBtn:".popup__button",isLoading:!0,createBtn:!0}),function(e,t){return fetch("".concat(t.baseURL,"cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(c)}(n,a).then((function(t){p.prepend(e(t,R,t.owner._id,t.owner._id,t._id,a))})).then((function(){u({modal:_,popupBtn:".popup__button",isLoading:!1,createBtn:!0}),o(_),B.reset()})).catch((function(e){console.log(e)}))})),U=P,Array.from(document.querySelectorAll(U.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessageValid):e.setCustomValidity("")}(t),t.validity.valid?s(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}(n,o,t)}))}))}(e,U)}))})();